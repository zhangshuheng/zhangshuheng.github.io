https://www.peterdavehello.org/2016/01/ubuntu-based-gnulinux-firewall-ufw-essential-config/
Ubuntu based GNU/Linux 上的防火 (ufw) 基本O定
Posted on 2016-01-14
早期在 Linux 上O定防火多事透^ iptables @b程式在下t，不^f真的，於新手或是要求很基本的使用者碚f，iptables 有些功能其用不到，例如 nat, forward等等的, 而且Z法有c}s，我自己也是常常要翻 man page 、P操作，後碛辛肆钜惶兹名叫作 Uncomplicated Firewall 的 ufw，意思就是蔚摹⒉谎}s的防火，相於 iptables 碚f，ufw 是真的魏芏嗔耍ufw其只是一 iptables 的前端O定程式，最後的t都是走 iptables ，而且比^}s的功能是要直接透^ iptables 才有k法做到！如果想看 ufw O定完的 iptables Y果只要用@命令就可以看到了：iptables -L -n

今天碇v一下 ufw 的”基本“使用方式，Ubuntu 14.04 有冉 ufw，Debian要自行安b，透^ apt-get 就可以了：
$ sudo apt-get install ufw

接下硎竟的操作都在 Ubuntu 14.04 上面M行，不同的系y可以略有出入。

ufw AO是停用的，要⒂ ufw 的命令如下，PI字分e是 enable 和 disable，也就是⒂煤屯Ｓ茫因樾枰 root 嘞蓿所以命令前面加上 sudo：
$ sudo ufw enable
Firewall is active and enabled on system startup

同理，停用 ufw：
$ sudo ufw disable
Firewall stopped and disabled on system startup

要_J ufw 已⒂茫可以看一下 ufw 的 status:

已⒂茫
$ sudo ufw status
Status: active

未⒂茫
$ sudo ufw status
Status: inactive

那防火的允S跟禁止t怎N下呢？
PI字是 allow 跟 deny，allow 表示允S，deny 表示拒^

先v怎NO定防火AO行椋也就是於]有手釉O定t的B怎N理

比^安全的O定方式，建h把AOB入O定 deny ，也就是]有手釉O定允S通^的B就被跸恚
$ sudo ufw default deny

明_一c的指令是@樱
$ sudo ufw default deny incoming


如果]有特e指名 incoming (B入) / outgoing (B出)， ufw 就J槟阍B入的B下t！

相反的，AO允S所有B入B通^就是：
$ sudo ufw default allow

AO行檫@部份在 ufw status 看不到Y果，但是我加上 verbose  ufw 列出Y就看的到了：
$ sudo ufw status verbose
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), disabled (routed)
New profiles: skip

那怎NB接埠或服赵O定t？

基本Z法如下，port可以Q成服彰Q：
ufw <allow/deny> <port>

也就是跟 ufw f你要允S或是拒^某B接埠或是服站涂梢粤耍例如架O部落格的就可以@酉拢ufw 知道 http AO是使用 80 port：
(P於 port / serveice 的可以⒖ /etc/services)
$ sudo ufw allow http

ufw 回：
Rule added
Rule added (v6)

O定好了之後一涌梢酝高^ ufw status _J：
$ sudo ufw status
Status: active

To Action From
― ―― ―-
80 ALLOW Anywhere
80 (v6) ALLOW Anywhere (v6)

想要禁止 ssh BB入就可以：
$ sudo ufw deny ssh

如果要M一步指定套用t在 tcp 或 udp B的可以@酉拢
$ sudo ufw allow http/tcp
$ sudo ufw allow http/udp

要a充的是，@的tAO都是”B入“的行椋 ufw 其可以在 deny / allow 後面接上 in / out 肀硎具B入或B出，如果你不想要你的X可以蜻^实 http / https port B到期他W站，可以⒖歼@拥墓例：

$ ufw deny out http
$ ufw deny out https

如果要h除O定的t呢？或是要修改？

ufw h除t的方法很危就是在原本的t前面加上 delete (h除) @PI字：
$ sudo ufw delete allow http/tcp

ufw 回：
Rule deleted
Rule deleted (v6)

至於修改的，就是把f的h掉再加入新t~

接下碇vB ip O定

Z法椋
ufw allow / deny from / to ip

@的 from / to 就跟的 in / out 有c像了，在IP的表示部份是支援W路遮罩的，例如我想要所有^域W路鹊碓纯梢匀我獾拇嫒∵@台系y上的服湛梢赃@幼觯
(染WIP⒖wiki)
$ sudo ufw allow from 10.0.0.0/8
$ sudo ufw allow from 172.16.0.0/12
$ sudo ufw allow from 192.168.0.0/16

如果我想要禁止 192.168.1.123 @ IP 淼倪B
$ sudo ufw deny from 192.168.1.123

也可以加上 port 的l件:
$ sudo ufw deny from 192.168.1.1 port 22

假O我ν庵挥幸IP 192.168.1.1，而我要禁止@IPB到其他主C http / https AO的 80 / 443 port，除了的例(ufw deny out http)，也可以@幼觯
$ sudo ufw deny from 192.168.1.1 to any port 80
$ sudo ufw deny from 192.168.1.1 to any port 443

@用了一PI字 any ，表示@t是用於到任何要B出的IP，同游也可以用@Z法斫止所有B入的 ssh B，磉_到跟前面例 ufw deny ssh 一拥男Ч：
$ sudo ufw deny from any to 192.168.1.1 port 22

如果同一台主C了多不同 IP，但我只想禁止外部B入其中一IP，不要全部禁止，可以同r使用 from 跟 to 的t

例如我只想禁止 IP 192.168.1.1 到我的 192.168.1.104 IP 的B：
$ sudo ufw deny from 192.168.1.1 to 192.168.1.104

那@h除的方法都一樱就是在 ufw 後面加上 delete @PI字，後面接原本的t即可
$ sudo ufw delete deny from 192.168.1.1 to 192.168.1.104

比^h除t的方法

如果t一多，又忘原本下了什Nt，要怎Nh除t呢？

一方法是直接重O ufw ，那把所有t通通清掉：
$ sudo ufw reset

Resetting all rules to installed defaults. Proceed with operation (y|n)? y
Backing up 'after.rules' to '/etc/ufw/after.rules.20160114_215851'
Backing up 'after6.rules' to '/etc/ufw/after6.rules.20160114_215851'
Backing up 'before6.rules' to '/etc/ufw/before6.rules.20160114_215851'
Backing up 'before.rules' to '/etc/ufw/before.rules.20160114_215851'
Backing up 'user6.rules' to '/lib/ufw/user6.rules.20160114_215851'
Backing up 'user.rules' to '/lib/ufw/user.rules.20160114_215851'

令一方法是， ufw 告V我t的，在 ufw status 後面加上 numbered
$ sudo ufw status numbered

Status: active

To Action From
― ―― ―-
[ 1] 22 DENY OUT Anywhere
[ 2] 80 DENY IN Anywhere
[ 3] 443 DENY IN 192.168.1.123
[ 4] 23/tcp DENY IN Anywhere
[ 5] 22 (v6) DENY IN Anywhere (v6)
[ 6] 80 (v6) DENY IN Anywhere (v6)
[ 7] 443 (v6) DENY IN Anywhere (v6)
[ 8] 23/tcp (v6) DENY IN Anywhere (v6)

那 1, 2, 3, … 8 就是t的，要h除某一lt只要@泳涂梢粤耍
$ sudo ufw delete 2

Deleting:
deny 80
Proceed with operation (y|n)? y
Rule deleted

最後v一下 ufw 的 logging 功能

常防火提供的日I功能 ufw 也]有少

⒂萌照I功能：
$ sudo ufw logging on

停用日I功能：
$ sudo ufw logging off

日IAO存在 /var/log/ufw.log ，如果X得AO提供的Y不蚨啵也可以{高日I的蛹， ufw 日I蛹有 low、medium、high、full 四N，AO low ，淖蟮接曳e愈，但日I就子糜大的磁碟空g，平建h使用 low 或 medium 即可， 有遇到攻艋蛱e情r再M行{整。